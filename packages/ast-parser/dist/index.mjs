function _(t){return t===" "||t==="	"||t===`
`||t==="\r"}function x(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}function u(t){return t>="0"&&t<="9"}function m(t){return t==="_"}var y=(s=>(s.Let="Let",s.Const="Const",s.Var="Var",s.Assign="Assign",s.Function="Function",s.Number="Number",s.Operator="Operator",s.Identifier="Identifier",s.LeftParen="LeftParen",s.RightParen="RightParen",s.LeftCurly="LeftCurly",s.RightCurly="RightCurly",s.Comma="Comma",s.Dot="Dot",s.Semicolon="Semicolon",s.StringLiteral="StringLiteral",s.Return="Return",s.Import="Import",s.Export="Export",s.Default="Default",s.From="From",s.As="As",s.Asterisk="Asterisk",s))(y||{}),C=(n=>(n[n.Normal=0]="Normal",n[n.Identifier=1]="Identifier",n[n.StringLiteral=2]="StringLiteral",n[n.Number=3]="Number",n))(C||{}),c={let(t){return{type:"Let",value:"let",start:t,end:t+3}},const(t){return{type:"Const",value:"const",start:t,end:t+5}},var(t){return{type:"Var",value:"var",start:t,end:t+3}},assign(t){return{type:"Assign",value:"=",start:t,end:t+1}},import(t){return{type:"Import",value:"import",start:t,end:t+6}},export(t){return{type:"Export",value:"export",start:t,end:t+6}},from(t){return{type:"From",value:"from",start:t,end:t+4}},as(t){return{type:"As",value:"as",start:t,end:t+2}},asterisk(t){return{type:"Asterisk",value:"*",start:t,end:t+1}},default(t){return{type:"Default",value:"default",start:t,end:t+7}},number(t,e){return{type:"Number",value:e,start:t,end:t+e.length,raw:e}},function(t){return{type:"Function",value:"function",start:t,end:t+8}},return(t){return{type:"Return",value:"return",start:t,end:t+6}},operator(t,e){return{type:"Operator",value:e,start:t,end:t+e.length}},comma(t){return{type:"Comma",value:",",start:t,end:t+1}},leftParen(t){return{type:"LeftParen",value:"(",start:t,end:t+1}},rightParen(t){return{type:"RightParen",value:")",start:t,end:t+1}},leftCurly(t){return{type:"LeftCurly",value:"{",start:t,end:t+1}},rightCurly(t){return{type:"RightCurly",value:"}",start:t,end:t+1}},dot(t){return{type:"Dot",value:".",start:t,end:t+1}},semicolon(t){return{type:"Semicolon",value:";",start:t,end:t+1}},stringLiteral(t,e,r){return{type:"StringLiteral",value:e,start:t,end:t+e.length+2,raw:r}},identifier(t,e){return{type:"Identifier",value:e,start:t,end:t+e.length}}},f=new Map([["(",c.leftParen],[")",c.rightParen],["{",c.leftCurly],["}",c.rightCurly],[".",c.dot],[";",c.semicolon],[",",c.comma],["*",c.asterisk],["=",c.assign]]),I=["'",'"',"`"],k=["+","-","*","/","%","^","&","|","~","<<",">>"],h=class{_tokens=[];_currentIndex=0;_source;_scanMode=0;constructor(e){this._source=e}scanIndentifier(){this._setScanMode(1);let e="",r=this._getCurrentChar(),i=this._currentIndex;for(;x(r)||u(r)||m(r);)e+=r,this._currentIndex++,r=this._getCurrentChar();let n;e in c?n=c[e](i):n=c.identifier(i,e),this._tokens.push(n),this._resetScanMode()}scanStringLiteral(){this._setScanMode(2);let e=this._currentIndex,r=this._getCurrentChar(),i=r;this._currentIndex++;let n="";for(r=this._getCurrentChar();r&&r!==i;)n+=r,this._currentIndex++,r=this._getCurrentChar();let o=c.stringLiteral(e,n,`${i}${n}${i}`);this._tokens.push(o),this._resetScanMode()}_scanNumber(){this._setScanMode(3);let e=this._currentIndex,r="",i=this._getCurrentChar(),n=!1;for(;u(i)||i==="."&&!n;)i==="."&&(n=!0),r+=i,this._currentIndex++,i=this._getCurrentChar();if(n&&i===".")throw new Error('Unexpected character "."');let o=c.number(e,r);this._tokens.push(o),this._resetScanMode()}tokenize(){for(;this._currentIndex<this._source.length;){let e=this._source[this._currentIndex],r=this._currentIndex;if(_(e)){this._currentIndex++;continue}else if(x(e)){this.scanIndentifier();continue}else if(f.has(e)){if(e==="*"){let n=this._getPreviousToken();if(n.type!=="Import"&&n.type!=="Export"){this._tokens.push(c.operator(r,e)),this._currentIndex++;continue}}let i=f.get(e)(r);this._tokens.push(i),this._currentIndex++}else if(I.includes(e)){this.scanStringLiteral(),this._currentIndex++;continue}else if(k.includes(e)&&this._scanMode===0){this._tokens.push(c.operator(r,e)),this._currentIndex++;continue}else if(k.includes(e+this._getNextChar())&&this._scanMode===0){this._tokens.push(c.operator(r,e+this._getNextChar())),this._currentIndex+=2;continue}else if(u(e)){this._scanNumber();continue}}return this._resetCurrentIndex(),this._getTokens()}_getCurrentChar(){return this._source[this._currentIndex]}_getNextChar(){return this._currentIndex+1<this._source.length?this._source[this._currentIndex+1]:""}_resetCurrentIndex(){this._currentIndex=0}_getTokens(){return this._tokens}_getPreviousToken(){if(this._tokens.length>0)return this._tokens[this._tokens.length-1];throw new Error("Previous token not found")}_setScanMode(e){this._scanMode=e}_resetScanMode(){this._scanMode=0}};var g=(a=>(a.Program="Program",a.VariableDeclaration="VariableDeclaration",a.FunctionDeclaration="FunctionDeclaration",a.Identifier="Identifier",a.BlockStatement="BlockStatement",a.ExpressionStatement="ExpressionStatement",a.ReturnStatement="ReturnStatement",a.CallExpression="CallExpression",a.BinaryExpression="BinaryExpression",a.MemberExpression="MemberExpression",a.FunctionExpression="FunctionExpression",a.Literal="Literal",a.ImportDeclaration="ImportDeclaration",a.ImportSpecifier="ImportSpecifier",a.ImportDefaultSpecifier="ImportDefaultSpecifier",a.ImportNamespaceSpecifier="ImportNamespaceSpecifier",a.ExportDeclaration="ExportDeclaration",a.ExportSpecifier="ExportSpecifier",a.ExportDefaultDeclaration="ExportDefaultDeclaration",a.ExportNamedDeclaration="ExportNamedDeclaration",a.ExportAllDeclaration="ExportAllDeclaration",a.VariableDeclarator="VariableDeclarator",a))(g||{}),E=(r=>(r[r.FunctionDeclaration=0]="FunctionDeclaration",r[r.CallExpression=1]="CallExpression",r))(E||{});var d=class{_tokens=[];_currentIndex=0;constructor(e){this._tokens=[...e]}parse(){return this._parseProgram()}_parseProgram(){let e={type:"Program",body:[],start:0,end:1/0};for(;!this._isEnd();){let r=this._parseStatement();e.body.push(r),this._isEnd()&&(e.end=r.end)}return e}_parseStatement(){if(this._checkCurrentTokenType("Function"))return this._parseFunctionDeclaration();if(this._checkCurrentTokenType("Identifier"))return this._parseExpressionStatement();if(this._checkCurrentTokenType("LeftCurly"))return this._parseBlockStatement();if(this._checkCurrentTokenType("Return"))return this._parseReturnStatement();if(this._checkCurrentTokenType("Import"))return this._parseImportStatement();if(this._checkCurrentTokenType("Export"))return this._parseExportStatement();if(this._checkCurrentTokenType(["Let","Var","Const"]))return this._parseVariableDeclaration();throw console.log(this._getCurrentToken()),new Error("Unexpected token")}_parseImportStatement(){let{start:e}=this._getCurrentToken(),r=[];if(this._goNext("Import"),this._checkCurrentTokenType("Identifier")){let o=this._parseIdentifier(),p={type:"ImportDefaultSpecifier",local:o,start:o.start,end:o.end};r.push(p),this._checkCurrentTokenType("Comma")&&this._goNext("Comma")}if(this._checkCurrentTokenType("LeftCurly")){for(this._goNext("LeftCurly");!this._checkCurrentTokenType("RightCurly");){let o=this._parseIdentifier(),p=null;this._checkCurrentTokenType("As")&&(this._goNext("As"),p=this._parseIdentifier());let l={type:"ImportSpecifier",imported:o,local:p||o,start:o.start,end:p?p.end:o.end};r.push(l),this._checkCurrentTokenType("Comma")&&this._goNext("Comma")}this._goNext("RightCurly")}else if(this._checkCurrentTokenType("Asterisk")){let{start:o}=this._getCurrentToken();this._goNext("Asterisk"),this._goNext("As");let p=this._parseIdentifier(),l={type:"ImportNamespaceSpecifier",local:p,start:o,end:p.end};r.push(l)}this._checkCurrentTokenType("From")&&this._goNext("From");let i=this._parseLiteral(),n={type:"ImportDeclaration",specifiers:r,start:e,end:i.end,source:i};return this._skipSemicolon(),n}_parseExportStatement(){let{start:e}=this._getCurrentToken(),r=null,i=[];if(this._goNext("Export"),this._checkCurrentTokenType("Default")){if(this._goNext("Default"),this._checkCurrentTokenType("Identifier")){let n=this._parseExpression();r={type:"ExportDefaultDeclaration",declaration:n,start:n.start,end:n.end}}else if(this._checkCurrentTokenType("Function")){let n=this._parseFunctionDeclaration();r={type:"ExportDefaultDeclaration",declaration:n,start:e,end:n.end}}}else if(this._checkCurrentTokenType("LeftCurly")){for(this._goNext("LeftCurly");!this._checkCurrentTokenType("RightCurly");){let o=this._parseIdentifier(),p=o;this._checkCurrentTokenType("As")&&(this._goNext("As"),p=this._parseIdentifier());let l={type:"ExportSpecifier",local:o,exported:p,start:o.start,end:p.end};i.push(l),this._checkCurrentTokenType("Comma")&&this._goNext("Comma")}this._goNext("RightCurly"),this._checkCurrentTokenType("From")&&this._goNext("From");let n=this._parseLiteral();r={type:"ExportNamedDeclaration",specifiers:i,start:e,declaration:null,end:n.end,source:n}}else if(this._checkCurrentTokenType(["Const","Let","Var"])){let n=this._parseVariableDeclaration();return r={type:"ExportNamedDeclaration",declaration:n,start:e,end:n.end,specifiers:i,source:null},r}else if(this._checkCurrentTokenType("Function")){let n=this._parseFunctionDeclaration();r={type:"ExportNamedDeclaration",declaration:n,start:e,end:n.end,specifiers:i,source:null}}else{this._goNext("Asterisk");let n=null;this._checkCurrentTokenType("As")&&(this._goNext("As"),n=this._parseIdentifier()),this._goNext("From");let o=this._parseLiteral();r={type:"ExportAllDeclaration",start:e,end:o.end,source:o,exported:n}}if(!r)throw new Error("Export declaration cannot be parsed");return this._skipSemicolon(),r}_parseVariableDeclaration(){let{start:e}=this._getCurrentToken(),r=this._getCurrentToken().value;this._goNext(["Let","Var","Const"]);let i=[],n=()=>{if(this._checkCurrentTokenType("Semicolon"))return!0;let p=this._getNextToken();return!(p&&p.type==="Assign")};for(;!n();){let p=this._parseIdentifier(),l=null;this._checkCurrentTokenType("Assign")&&(this._goNext("Assign"),this._checkCurrentTokenType(["Number","StringLiteral"])?l=this._parseLiteral():l=this._parseExpression());let T={type:"VariableDeclarator",id:p,init:l,start:p.start,end:l?l.end:p.end};i.push(T),this._checkCurrentTokenType("Comma")&&this._goNext("Comma")}let o={type:"VariableDeclaration",kind:r,declarations:i,start:e,end:this._getPreviousToken().end};return this._skipSemicolon(),o}_parseReturnStatement(){let{start:e}=this._getCurrentToken();this._goNext("Return");let r=this._parseExpression(),i={type:"ReturnStatement",argument:r,start:e,end:r.end};return this._skipSemicolon(),i}_parseExpressionStatement(){let e=this._parseExpression();return{type:"ExpressionStatement",expression:e,start:e.start,end:e.end}}_parseExpression(){if(this._checkCurrentTokenType("Function"))return this._parseFunctionExpression();if(this._checkCurrentTokenType(["Number","StringLiteral"]))return this._parseLiteral();let e=this._parseIdentifier();for(;!this._isEnd();)if(this._checkCurrentTokenType("LeftParen"))e=this._parseCallExpression(e);else if(this._checkCurrentTokenType("Dot"))e=this._parseMemberExpression(e);else if(this._checkCurrentTokenType("Operator"))e=this.__parseBinaryOperatorExpression(e);else break;return e}__parseBinaryOperatorExpression(e){let{start:r}=this._getCurrentToken(),i=this._getCurrentToken().value;this._goNext("Operator");let n=this._parseExpression();return{type:"BinaryExpression",operator:i,left:e,right:n,start:r,end:n.end}}_parseMemberExpression(e){this._goNext("Dot");let r=this._parseIdentifier();return{type:"MemberExpression",object:e,property:r,start:e.start,end:r.end,computed:!1}}_parseCallExpression(e){let r=this._parseParams(1),{end:i}=this._getPreviousToken(),n={type:"CallExpression",callee:e,arguments:r,start:e.start,end:i};return this._skipSemicolon(),n}_parseFunctionDeclaration(){let{start:e}=this._getCurrentToken();this._goNext("Function");let r=null;this._checkCurrentTokenType("Identifier")&&(r=this._parseIdentifier());let i=this._parseParams(),n=this._parseBlockStatement();return{type:"FunctionDeclaration",id:r,params:i,body:n,start:e,end:n.end}}_parseFunctionExpression(){let{start:e}=this._getCurrentToken();this._goNext("Function");let r=null;this._checkCurrentTokenType("Identifier")&&(r=this._parseIdentifier());let i=this._parseParams(),n=this._parseBlockStatement();return{type:"FunctionExpression",id:r,params:i,body:n,start:e,end:n.end}}_parseParams(e=0){this._goNext("LeftParen");let r=[];for(;!this._checkCurrentTokenType("RightParen");){let i=e===0?this._parseIdentifier():this._parseExpression();r.push(i),this._checkCurrentTokenType("RightParen")||this._goNext("Comma")}return this._goNext("RightParen"),r}_parseLiteral(){let e=this._getCurrentToken(),r=e.value;e.type==="Number"&&(r=Number(r));let i={type:"Literal",value:e.value,start:e.start,end:e.end,raw:e.raw};return this._goNext(e.type),i}_parseIdentifier(){let e=this._getCurrentToken(),r={type:"Identifier",name:e.value,start:e.start,end:e.end};return this._goNext("Identifier"),r}_parseBlockStatement(){let{start:e}=this._getCurrentToken(),r={type:"BlockStatement",body:[],start:e,end:1/0};for(this._goNext("LeftCurly");!this._checkCurrentTokenType("RightCurly");){let i=this._parseStatement();r.body.push(i)}return r.end=this._getCurrentToken().end,this._goNext("RightCurly"),r}_checkCurrentTokenType(e){if(this._isEnd())return!1;let r=this._tokens[this._currentIndex];return Array.isArray(e)?e.includes(r.type):r.type===e}_skipSemicolon(){this._checkCurrentTokenType("Semicolon")&&this._goNext("Semicolon")}_goNext(e){let r=this._tokens[this._currentIndex];if(Array.isArray(e)){if(!e.includes(r.type))throw new Error(`Expect ${e.join(",")}, but got ${r.type}`)}else if(r.type!==e)throw new Error(`Expect ${e}, but got ${r.type}`);return this._currentIndex++,r}_isEnd(){return this._currentIndex>=this._tokens.length}_getCurrentToken(){return this._tokens[this._currentIndex]}_getPreviousToken(){return this._tokens[this._currentIndex-1]}_getNextToken(){return this._currentIndex+1<this._tokens.length?this._tokens[this._currentIndex+1]:!1}};function te(t){let r=new h(t).tokenize();return new d(r).parse()}export{E as FunctionType,g as NodeType,C as ScanMode,y as TokenType,h as Tokenizer,te as parse};
